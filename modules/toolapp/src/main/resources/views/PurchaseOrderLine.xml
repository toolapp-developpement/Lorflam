<?xml version="1.0" encoding="UTF-8"?>
<object-views xmlns="http://axelor.com/xml/ns/object-views"
  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xsi:schemaLocation="http://axelor.com/xml/ns/object-views http://axelor.com/xml/ns/object-views/object-views_5.4.xsd">

  <form name="purchase-order-line-form" title="PO line"
    model="com.axelor.apps.purchase.db.PurchaseOrderLine" id="custom-purchase-order-line-form"
    extension="true">
    <extend target="/">
      <attribute name="onLoad"
        value="action-group-purchase-purchase-orderline-onload-custome"/>
    </extend>
    <extend target="//field[@name='enableFreezeFields']">
      <replace>
        <field name="yard" onChange="action.specifique.purch.method.select.or.create.yard"
          colSpan="2"/>
      </replace>
    </extend>
  </form>

  <grid name="purchase-order-line-grid" id="purchase-order-line-custo-grid" title="PO lines"
    model="com.axelor.apps.purchase.db.PurchaseOrderLine" extension="true">
    <extend target="//field[@name='product.code']">
      <insert position="after">
        <field name="product.productCategory.code" title="CatÃ©gorie produit"/>
      </insert>
    </extend>
    <extend target="//field[@name='qty']">
      <insert position="after">
        <field name="qtyToReceive"/>
      </insert>
    </extend>
  </grid>

  <form id="custome-purchase-order-line-project-form" name="purchase-order-line-project-form"
    title="PO line" model="com.axelor.apps.purchase.db.PurchaseOrderLine"
    onLoad="action-group-purchase-purchase-orderline-onload" readonlyIf="true" canEdit="false"
    extension="true">
    <extend target="/">
      <attribute name="onLoad"
        value="action-group-purchase-purchase-orderline-onload-custome"/>
    </extend>
  </form>

  <action-method name="action.specifique.purch.method.select.or.create.yard">
    <call class="bzh.toolapp.apps.specifique.web.PlanificationController"
      method="selectOrCreateYard(__this__.yard)"/>
  </action-method>

  <action-record name="action-purchase-order-line-record-new"
    model="com.axelor.apps.purchase.db.PurchaseOrderLine"
    id="action-purchase-order-line-record-new-custom">
    <field name="qty" expr="eval: 1"/>
    <field name="desiredDelivDate" expr="eval: __parent__?.deliveryDate"/>
    <field name="$isFilterOnSupplier" expr="eval: false"/>
    <field
      if="__parent__ != null &amp;&amp; __parent__._model == 'com.axelor.apps.purchase.db.PurchaseOrder' &amp;&amp; receiptState &lt; 2"
      name="estimatedDelivDate" expr="eval: __parent__?.deliveryDate"/>
  </action-record>

  <action-group name="action-group-purchase-purchase-orderline-onnew"
    id="action-group-purchase-purchase-orderline-onnew-custome">
    <action name="action-purchase-order-line-attrs-title-project"/>
    <action name="action-purchase-order-line-attrs-scale-and-precision"/>
    <action name="action-purchase-order-line-record-new-custom"/>
    <action name="action-purchase-order-line-record-project"/>
    <action name="action-purchase-order-attrs-hide-ati"/>
    <action name="action-purchase-order-line-attrs-show-priceDiscounted"/>
    <action name="action-purchase-order-line-attrs-hide-qty-warning-label"/>
    <action name="action-purchase-order-line-attrs-hide-different-supplier-warning-label"/>
  </action-group>

  <action-group name="action-group-purchase-purchase-orderline-onload-custome"
    id="action-group-purchase-purchase-orderline-onload-custome">
    <action name="action-purchase-order-line-attrs-readonly-form-custome"/>
    <action name="action-purchase-order-line-method-check-qty"/>
    <action name="action-purchase-order-line-attrs-title-project"/>
    <action name="action-purchase-order-line-attrs-scale-and-precision"/>
    <action name="action-purchase-order-attrs-hide-ati"/>
    <action name="action-purchase-order-line-attrs-show-priceDiscounted"/>
    <action name="action-purchase-order-line-attrs-delivery-panel"/>
    <action name="action-budget-distribution-attrs-budget-amount-available"
      if="__config__.app.isApp('budget') &amp;&amp; __config__.app.getApp('budget').getManageMultiBudget()"/>
    <action name="action-purchase-order-line-attrs-set-isFilterOnSupplier"/>
    <action name="action-purchase-order-line-method-check-different-supplier"/>
  </action-group>

  <action-attrs name="action-purchase-order-line-attrs-readonly-form-custome">
    <attribute name="readonly" for="informationsPanel"
      expr="eval: __parent__?.statusSelect &gt; 3"/>
    <attribute name="readonly" for="supplierRequestsPanel"
      expr="eval: __parent__?.statusSelect &gt; 2"/>
    <attribute name="readonly" for="budgetDistributionPanel"
      expr="eval: __parent__?.statusSelect &gt; 2"/>
    <attribute name="readonly" for="projectPanel"
      expr="eval: __parent__?.statusSelect &gt; 3"/>
    <attribute name="readonly" for="budgetPanel"
      expr="eval: __parent__?.statusSelect &gt; 2"/>
    <attribute name="readonly" for="deliveryInformationPanel"
      expr="eval: __parent__?.statusSelect &gt; 3"/>
  </action-attrs>
</object-views>