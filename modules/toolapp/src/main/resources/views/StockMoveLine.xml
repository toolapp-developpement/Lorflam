<?xml version="1.0" encoding="UTF-8"?>
<object-views xmlns="http://axelor.com/xml/ns/object-views"
  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xsi:schemaLocation="http://axelor.com/xml/ns/object-views http://axelor.com/xml/ns/object-views/object-views_5.4.xsd">

  <form name="stock-move-line-form" title="Stock move line"
    model="com.axelor.apps.stock.db.StockMoveLine" id="custome-stock-move-line-form"
    extension="true">
    <extend target="//field[@name='product']">
      <insert position="after">
        <field name="yard" title="Référence Chantier"
          onChange="action.specifique.stock.move.method.select.or.create.yard" colSpan="2"/>
      </insert>
    </extend>
    <extend target="//field[@name='unitPriceUntaxed']">
      <insert position="after">
        <spacer/>
        <field name="discountTypeSelect" colSpan="4"
          onChange="action.stock.move.line.update.discount.price" hideIf="stockMove.originId"/>
        <field name="discountAmount" colSpan="4" x-scale="2"
          onChange="action.stock.move.line.update.discount.price" hideIf="stockMove.originId"/>
        <field name="priceDiscounted" colSpan="4" readonly="true" x-scale="2"
          hideIf="stockMove.originId"/>
        <field name="stockMove.originId" hidden="true"/>
      </insert>
    </extend>
  </form>

  <grid name="stock-move-line-grid" title="Stock move line"
    model="com.axelor.apps.stock.db.StockMoveLine" id="custome-stock-move-line-fogridrm"
    extension="true">
    <extend target="//field[@name='unitPriceUntaxed']">
      <insert position="after">
        <field name="stockMove.originId" hidden="true"/>

      </insert>
    </extend>
  </grid>

  <grid name="stock-move-line-grid-with-discount" title="Stock move lines"
    model="com.axelor.apps.stock.db.StockMoveLine" editable="true"
    onNew="action-stock-move-line-attrs-sub-line" edit-icon="true">
    <hilite color="default" strong="true" if="lineTypeSelect != 0"/>
    <field name="lineTypeSelect" hidden="true"/>
    <field name="product"
      readonlyIf="lineTypeSelect == 1 || (($get('stockMove.statusSelect') == 2 &amp;&amp; $get('stockMove.pickingIsEdited')) || $get('stockMove.statusSelect') == 3)"
      width="250px" canEdit="false" onChange="action-group-stock-stockmoveline-product-onchange"
      onSelect="action-stock-move-line-method-product-domain" form-view="product-form"
      grid-view="stock-move-line-product-grid"/>
    <field name="purchaseOrderLine.productCode"/>
    <field name="product.code"/>
    <field if="__config__.app.getApp('base').getManageProductVariants()" name="productModel"
      readonlyIf="lineTypeSelect == 1 || product" domain="self.isModel = true "
      form-view="product-form" grid-view="product-grid"/>
    <field name="productName"
      readonlyIf="($get('stockMove.statusSelect') == 2 &amp;&amp; $get('stockMove.pickingIsEdited')) || $get('stockMove.statusSelect') == 3"
      width="200px" required="true"/>
    <field name="qty" readonlyIf="$get('stockMove.statusSelect') > 1" width="100px"
      onChange="action-stock-move-line-group-qty-onchange" aggregate="sum" x-scale="2"/>
    <field name="realQty"
      readonlyIf="($get('stockMove.statusSelect') == 2 &amp;&amp; $get('stockMove.pickingIsEdited')) || $get('stockMove.statusSelect') == 3"
      width="100px" onChange="action-stock-move-line-group-real-qty-onchange" aggregate="sum"
      x-scale="2"/>
    <field if="__config__.app.getApp('supplychain').getManageStockReservation()"
      if-module="axelor-supplychain" name="requestedReservedQty" readonly="true" aggregate="sum"
      x-scale="2"/>
    <field if="__config__.app.getApp('supplychain').getManageStockReservation()"
      if-module="axelor-supplychain" name="reservedQty" readonly="true" aggregate="sum" x-scale="2"/>
    <button if="__config__.app.getApp('supplychain')?.manageStockReservation"
      name="allocateAll" title="Allocate" hidden="true"
      readonlyIf="$get('stockMove.statusSelect') != 2 || $number(reservedQty) == $number(qty) || $get('product.productTypeSelect') == 'service'"
      icon="fa-plus-square" onClick="save,action-supplychain-stock-move-line-allocate-all"/>
    <button if="__config__.app.getApp('supplychain')?.manageStockReservation"
      name="deallocate" title="Deallocate" hidden="true"
      readonlyIf="$get('stockMove.statusSelect') != 2 || $number(reservedQty) == 0"
      icon="fa-minus-square" onClick="save,action-supplychain-stock-move-line-deallocate-all"/>
    <field name="qtyInvoiced" readonly="true" x-scale="2"/>
    <field name="unitPriceUntaxed"
      readonlyIf="lineTypeSelect == 1 || $get('stockMove.pickingIsEdited') || saleOrderLine || purchaseOrderLine"
      width="120px" onChange="action-stock-move-line-record-price-onchange" x-scale="2"/>
    <field name="discountTypeSelect"
      onChange="action.stock.move.line.update.discount.price, action-invoice-line-attrs-discountamount-title"/>
    <field name="discountAmount" onChange="action.stock.move.line.update.discount.price"
      x-scale="2"/>
    <field name="priceDiscounted" readonly="true" x-scale="2"/>
    <field name="unitPriceTaxed" hidden="true" x-scale="2"/>
    <field name="companyUnitPriceUntaxed" hidden="true"/>
    <field name="unit"
      readonlyIf="lineTypeSelect == 1 || (($get('stockMove.statusSelect') == 2 &amp;&amp; $get('stockMove.pickingIsEdited')) || $get('stockMove.statusSelect') == 3)"
      width="70px" form-view="unit-form" grid-view="unit-grid"/>
    <field name="netMass" readonlyIf="lineTypeSelect == 1" width="100px"
      onChange="action-stock-move-line-group-net-mass-onchange"/>
    <field name="wapPrice" hidden="true" x-scale="2"/>
    <field name="trackingNumber"
      readonlyIf="lineTypeSelect == 1 || $get('stockMove.statusSelect') > 2" canNew="true"
      onSelect="action-stock-move-line-attrs-tracking-number-domain"
      form-view="tracking-number-stock-move-line-form" grid-view="tracking-number-grid"
      readOnly="false"/>
    <field name="stockMove.fromStockLocation.typeSelect" hidden="true"/>
    <field name="stockMove.toStockLocation.typeSelect" hidden="true"/>
    <field name="product.trackingNumberConfiguration.isPurchaseTrackingManaged" hidden="true"/>
    <field name="product.trackingNumberConfiguration.isProductionTrackingManaged"
      hidden="true"/>
    <field name="product.trackingNumberConfiguration.isSaleTrackingManaged" hidden="true"/>
    <field name="stockMove.typeSelect" hidden="true"/>
    <field name="conformitySelect" readonlyIf="lineTypeSelect == 1"/>
    <field name="availableStatus" readonlyIf="lineTypeSelect == 1" width="150">
      <hilite color="success" strong="true" if="availableStatusSelect == 1"/>
      <hilite color="info" strong="true" if="availableStatusSelect == 2"/>
      <hilite color="danger" strong="true" if="availableStatusSelect == 3"/>
      <hilite color="warning" strong="true" if="availableStatusSelect == 4"/>
    </field>
    <field name="stockMove" hidden="true" width="120"/>
    <field name="stockMove.pickingIsEdited" hidden="true"/>
    <field name="stockMove.statusSelect" hidden="true"/>
    <field name="product.productTypeSelect" hidden="true"/>
    <field if="__config__.app.isApp('supplychain')" if-module="axelor-supplychain"
      name="saleOrderLine" hidden="true"/>
    <field if="__config__.app.isApp('supplychain')" if-module="axelor-supplychain"
      name="purchaseOrderLine" hidden="true"/>
    <button name="trackNumberWizardBtn" title="Split by tracking numbers"
      readonlyIf="lineTypeSelect == 1 || ($get('stockMove.statusSelect') > 1 || !$get('product.trackingNumberConfiguration.isPurchaseTrackingManaged') &amp;&amp; !$get('product.trackingNumberConfiguration.isProductionTrackingManaged') &amp;&amp; (!$get('product.trackingNumberConfiguration.isSaleTrackingManaged') || $get('stockMove.typeSelect') != 2))"
      icon="fa-barcode" onClick="save,action-stock-move-line-method-open-wizard"/>
  </grid>



  <action-method name="action.stock.move.line.update.discount.price">
    <call method="computeDiscountPrice"
      class="bzh.toolapp.apps.specifique.web.StockMoveLineControllerSpecifique"/>
  </action-method>

  <action-method name="action.specifique.stock.move.method.select.or.create.yard">
    <call class="bzh.toolapp.apps.specifique.web.PlanificationController"
      method="selectOrCreateYard(__this__.yard)"/>
  </action-method>
</object-views>